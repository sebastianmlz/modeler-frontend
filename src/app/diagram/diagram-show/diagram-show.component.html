


<div class="w-full min-h-[60vh] flex flex-col items-center justify-center bg-gradient-to-br from-blue-50 via-blue-100 to-blue-200 py-8">
	<div class="bg-white rounded-xl shadow-lg border border-blue-200 p-8 w-full max-w-5xl flex flex-row gap-6">
		<!-- Sidebar UML -->
		<app-show-sidebar class="w-64 mr-6" (addClass)="onAddClass($event)" (addRelation)="onAddRelation($event)"></app-show-sidebar>
		<!-- Editor principal -->
		<div class="flex-1 flex flex-col gap-4">
			<h2 class="text-2xl font-bold text-blue-800 flex items-center gap-2 mb-4">
				<i class="pi pi-sitemap text-yellow-400 text-2xl"></i>
				Editor de diagrama UML
			</h2>
			<!-- Controles básicos (guardar, restaurar, etc.) -->
					<div class="flex gap-4 mb-2">
						<button class="pButton p-button-rounded bg-yellow-300 text-blue-800 hover:bg-yellow-400 font-semibold px-4 py-2 flex items-center gap-2 transition shadow" (click)="saveVersion()" [disabled]="savingVersion">
							<i class="pi pi-save text-blue-800"></i>
							<span *ngIf="!savingVersion">Guardar versión</span>
							<span *ngIf="savingVersion">Guardando...</span>
						</button>
						<div *ngIf="saveError" class="text-red-500 font-semibold mt-2">{{ saveError }}</div>
						<button class="pButton p-button-rounded bg-blue-200 text-blue-800 hover:bg-blue-300 font-semibold px-4 py-2 flex items-center gap-2 transition shadow">
							<i class="pi pi-refresh text-blue-800"></i>
							Restaurar versión
						</button>
						<button class="pButton p-button-rounded bg-gray-200 text-blue-800 hover:bg-gray-300 font-semibold px-4 py-2 flex items-center gap-2 transition shadow" (click)="logSnapshot()">
							<i class="pi pi-eye text-blue-800"></i>
							Ver envío
						</button>
					</div>
			<!-- Mensaje de error o carga -->
			<div *ngIf="loadingVersion" class="text-blue-600 font-semibold mb-2">Cargando versión...</div>
			<div *ngIf="loadError" class="text-red-500 font-semibold mb-2">{{ loadError }}</div>
			<!-- Canvas para JointJS -->
			<div #diagramCanvas class="diagram-canvas bg-gray-100 rounded-lg border border-blue-300 shadow w-full h-[600px] flex items-center justify-center">
				<!-- Aquí se renderizará el canvas de JointJS -->
				<span class="text-gray-400">Canvas UML</span>
			</div>
		</div>
	</div>

	<!-- Modal edición clase UML -->
	<div *ngIf="showEditModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50">
		<div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-xl flex flex-col gap-4 border border-blue-300">
			<h3 class="text-xl font-bold text-blue-800 mb-2">Editar clase UML</h3>
					<label class="text-sm font-semibold text-gray-700 mb-1">Nombre de la clase</label>
					<input type="text" [(ngModel)]="editClassName" class="border border-blue-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" />


					   <label class="text-sm font-semibold text-gray-700 mt-4 mb-1">Atributos</label>
					   <div class="flex flex-wrap gap-2 mb-2">
						   <input type="text" [(ngModel)]="newAttr.name" placeholder="Nombre" class="border border-blue-300 rounded px-3 py-2 flex-1 min-w-[120px]" />
						   <select [(ngModel)]="newAttr.typeName" class="border border-blue-300 rounded px-2 py-2 min-w-[100px]">
							   <option value="String">String</option>
							   <option value="Integer">Integer</option>
							   <option value="Long">Long</option>
							   <option value="Boolean">Boolean</option>
							   <option value="Double">Double</option>
							   <option value="Date">Date</option>
						   </select>
						   <label class="flex items-center gap-1 text-xs">
							   <input type="checkbox" [(ngModel)]="newAttr.isPrimaryKey" [disabled]="hasPrimaryKey()" /> PK
						   </label>
						   <label class="flex items-center gap-1 text-xs">
							   <input type="checkbox" [(ngModel)]="newAttr.isRequired" /> Req
						   </label>
						   <button class="px-3 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600" (click)="addNewAttribute()" [disabled]="!newAttr.name">Agregar</button>
					   </div>
					   <ul class="mb-2">
						   <li *ngFor="let attr of editClassAttrs; let i = index" class="flex flex-wrap items-center gap-2 mb-1">
							   <input type="text" [(ngModel)]="attr.name" class="border border-blue-200 rounded px-2 py-1 flex-1 min-w-[120px]" />
							   <select [(ngModel)]="attr.typeName" class="border border-blue-200 rounded px-2 py-1 min-w-[100px]">
								   <option value="String">String</option>
								   <option value="Integer">Integer</option>
								   <option value="Long">Long</option>
								   <option value="Boolean">Boolean</option>
								   <option value="Double">Double</option>
								   <option value="Date">Date</option>
							   </select>
							   <label class="flex items-center gap-1 text-xs">
								   <input type="checkbox" [(ngModel)]="attr.isPrimaryKey" [disabled]="isPrimaryKeyDisabled(i)" /> PK
							   </label>
							   <label class="flex items-center gap-1 text-xs">
								   <input type="checkbox" [(ngModel)]="attr.isRequired" /> Req
							   </label>
							   <button class="px-2 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200" (click)="editClassAttrs.splice(i, 1)"><i class="pi pi-times"></i></button>
						   </li>
					   </ul>

					<div class="flex gap-2 mt-4 justify-end">
						<button class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300" (click)="showEditModal = false">Cancelar</button>
						<button class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-semibold" (click)="saveEditClass()">Guardar</button>
					</div>
		</div>
	</div>
</div>
