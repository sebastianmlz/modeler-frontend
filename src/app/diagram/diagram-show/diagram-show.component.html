<div style="position: fixed; top: 48px; left: 0; width: 100%; background: #f8fafc; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between; padding: 0.7rem 2rem 0.7rem 1.5rem; z-index: 200; height: 56px; box-sizing: border-box;">
	<div style="display: flex; align-items: center; gap: 1.5rem;">
		<span style="font-size: 1.15rem; font-weight: 600; color: #222; letter-spacing: 0.5px;">Diagrama UML</span>
		<!-- Aquí puedes agregar el nombre del diagrama si lo tienes -->
	</div>
	<div style="display: flex; align-items: center; gap: 1.2rem;">
		<!-- Espacio para miembros en tiempo real -->
		<div style="display: flex; align-items: center; gap: 0.5rem;">
			<!-- Aquí irán los avatares/nombres de los miembros -->
			<span style="color: #888; font-size: 0.98rem;">Miembros: (próximamente)</span>
		</div>
		<button (click)="saveDiagramVersion()" style="background: #2563eb; color: #fff; border: none; border-radius: 4px; padding: 0.45rem 1.3rem; font-weight: 500; font-size: 1rem; cursor: pointer;">Guardar versión</button>
	</div>
</div>
<!-- El contenido principal ahora tiene padding-top para no quedar debajo de la barra -->
<div style="display: flex; height: 100vh; padding-top: 104px; box-sizing: border-box;">
	<!-- Sidebar a la izquierda -->
	<div style="width: 260px; background: #f3f4f6; border-right: 1px solid #e5e7eb; padding: 0.5rem 0;">
		<app-show-sidebar (addClass)="addNewClass()" (selectRelation)="onRelationSelected($event)"></app-show-sidebar>
	</div>
	<!-- Diagramador principal -->
	<div style="flex: 1; display: flex; flex-direction: column; position: relative;">
		<ejs-diagram
			#umlDiagram
			id="umlDiagram"
			width="100%"
			height="calc(100vh - 0px)"
			[nodes]="nodes"
			[connectors]="connectors"
			[selectedItems]="selectedItems"
			(selectionChange)="onSelectionChange($event)">
		</ejs-diagram>
		<!-- Panel lateral de edición de clase -->
		<div *ngIf="selectedUMLClass" style="position: absolute; top: 0; right: 0; height: 100%; width: 380px; background: #fff; box-shadow: -2px 0 8px #0001; z-index: 50; padding: 1.5rem; overflow-y: auto; border-left: 1px solid #e5e7eb;">
			<h2 style="font-size: 1.1rem; font-weight: bold; margin-bottom: 0.5rem;">Editar Clase</h2>
			<div style="margin-bottom: 1rem;">
				<label style="display: block; font-size: 0.95rem; font-weight: 500;">Nombre de la clase</label>
				<input type="text" [(ngModel)]="selectedUMLClass.name" style="width: 100%; border: 1px solid #ccc; border-radius: 4px; padding: 0.3rem 0.5rem; margin-top: 0.3rem;" />
			</div>
			<div style="margin-bottom: 1rem;">
				<label style="display: block; font-size: 0.95rem; font-weight: 500;">Visibilidad</label>
				<select [(ngModel)]="selectedUMLClass.visibility" style="width: 100%; border: 1px solid #ccc; border-radius: 4px; padding: 0.3rem 0.5rem; margin-top: 0.3rem;">
					<option value="PUBLIC">Pública</option>
					<option value="PRIVATE">Privada</option>
					<option value="PROTECTED">Protegida</option>
				</select>
			</div>
			<h3 style="font-weight: 600; margin-bottom: 0.5rem;">Atributos</h3>
			<div *ngFor="let attr of selectedUMLClass.attributes; let i = index" style="margin-bottom: 0.7rem; border-bottom: 1px solid #eee; padding-bottom: 0.5rem;">
				<div style="display: flex; gap: 0.5rem; align-items: center;">
					<input type="text" [(ngModel)]="attr.name" placeholder="Nombre" style="border: 1px solid #ccc; border-radius: 4px; padding: 0.2rem 0.5rem; width: 90px;" />
					<select [(ngModel)]="attr.typeName" style="border: 1px solid #ccc; border-radius: 4px; padding: 0.2rem 0.5rem; width: 80px;">
						<option *ngFor="let t of attributeTypes" [value]="t">{{t}}</option>
					</select>
					<label style="display: flex; align-items: center; gap: 0.2rem; font-size: 0.95rem;">
						<input type="checkbox" [(ngModel)]="attr.isRequired" /> Obligatorio
					</label>
					<label style="display: flex; align-items: center; gap: 0.2rem; font-size: 0.95rem;">
						<input type="radio" name="pkRadio{{selectedUMLClass.id}}" [checked]="attr.isPrimaryKey" (change)="setPrimaryKey(i)" [disabled]="attr.isPrimaryKey || hasPrimaryKey && !attr.isPrimaryKey" /> PK
					</label>
					<button (click)="removeAttribute(i)" style="color: #e11d48; background: none; border: none; cursor: pointer; margin-left: 0.5rem;">Eliminar</button>
				</div>
				<div *ngIf="attributeNameExists(attr.name, i)" style="font-size: 0.85rem; color: #e11d48; margin-top: 0.2rem;">Nombre repetido</div>
			</div>
			<button (click)="addAttribute()" style="margin-top: 0.5rem; padding: 0.3rem 1.2rem; background: #2563eb; color: #fff; border-radius: 4px; border: none; font-weight: 500; cursor: pointer;">Agregar atributo</button>
			<!-- Botón para actualizar la clase en el canvas -->
			<button (click)="updateSelectedClassOnCanvas()" style="margin-top: 0.5rem; margin-left: 0.5rem; padding: 0.3rem 1.2rem; background: #059669; color: #fff; border-radius: 4px; border: none; font-weight: 500; cursor: pointer;">Actualizar clase</button>
			<button (click)="closeClassPanel()" style="position: absolute; top: 0.7rem; right: 0.7rem; color: #888; background: none; border: none; font-size: 1.3rem; cursor: pointer;">✕</button>
		</div>

        <!-- Panel lateral de edición de relación -->
        <div *ngIf="showRelationSidebar && editingRelation" style="position: absolute; top: 0; right: 0; height: 100%; width: 380px; background: #fff; box-shadow: -2px 0 8px #0001; z-index: 51; padding: 1.5rem; overflow-y: auto; border-left: 1px solid #e5e7eb;">
            <h2 style="font-size: 1.1rem; font-weight: bold; margin-bottom: 0.5rem;">Editar Relación</h2>
            <div style="margin-bottom: 1rem;">
                <label style="display: block; font-size: 0.95rem; font-weight: 500;">Nombre de la relación</label>
                <input type="text" [(ngModel)]="editingRelation.name" style="width: 100%; border: 1px solid #ccc; border-radius: 4px; padding: 0.3rem 0.5rem; margin-top: 0.3rem;" />
            </div>
			<div style="margin-bottom: 1rem; display: flex; gap: 1rem;">
				<div style="flex:1;">
					<label style="display: block; font-size: 0.95rem; font-weight: 500;">Multiplicidad Origen</label>
					<select [(ngModel)]="editingRelation.sourceMultiplicity" style="width: 100%; border: 1px solid #ccc; border-radius: 4px; padding: 0.3rem 0.5rem; margin-top: 0.3rem;">
						<option value="1">1</option>
						<option value="0..1">0..1</option>
						<option value="*">*</option>
						<option value="1..*">1..*</option>
					</select>
				</div>
				<div style="flex:1;">
					<label style="display: block; font-size: 0.95rem; font-weight: 500;">Multiplicidad Destino</label>
					<select [(ngModel)]="editingRelation.targetMultiplicity" style="width: 100%; border: 1px solid #ccc; border-radius: 4px; padding: 0.3rem 0.5rem; margin-top: 0.3rem;">
						<option value="1">1</option>
						<option value="0..1">0..1</option>
						<option value="*">*</option>
						<option value="1..*">1..*</option>
					</select>
				</div>
			</div>
			<div style="margin-bottom: 1rem;">
				<label style="display: block; font-size: 0.95rem; font-weight: 500;">Tipo de relación</label>
				<div style="width: 100%; border: 1px solid #ccc; border-radius: 4px; padding: 0.3rem 0.5rem; margin-top: 0.3rem; background: #f3f4f6; color: #444;">
				  {{ editingRelation.type }}
				</div>
			</div>
            <div style="margin-bottom: 1rem;">
                <label style="display: block; font-size: 0.95rem; font-weight: 500;">Clase de Asociación (para N a N)</label>
                <select [(ngModel)]="editingRelation.associationClassId" style="width: 100%; border: 1px solid #ccc; border-radius: 4px; padding: 0.3rem 0.5rem; margin-top: 0.3rem;">
                    <option [ngValue]="null">Ninguna</option>
                    <option *ngFor="let c of umlClasses" [ngValue]="c.id">{{c.name}}</option>
                </select>
            </div>
            <button (click)="saveRelationEdit()" style="margin-top: 0.5rem; padding: 0.3rem 1.2rem; background: #059669; color: #fff; border-radius: 4px; border: none; font-weight: 500; cursor: pointer;">Guardar cambios</button>
            <button (click)="closeRelationPanel()" style="margin-top: 0.5rem; margin-left: 0.5rem; padding: 0.3rem 1.2rem; background: #e11d48; color: #fff; border-radius: 4px; border: none; font-weight: 500; cursor: pointer;">Cancelar</button>
        </div>
		<!-- Botón flotante para eliminar relación -->
		<button *ngIf="selectedUMLRelationId" (click)="deleteSelectedRelation()" style="position: absolute; top: 20px; right: 30px; z-index: 100; background: #e11d48; color: #fff; border: none; border-radius: 4px; padding: 0.5rem 1.2rem; font-weight: 500; cursor: pointer;">Eliminar relación</button>
	</div>
</div>